import{e as y,r as l,j as e,f as t}from"./index-BRBX7hDb.js";import{C as Q,a as X,b as Z,P as ee,c as te,B as se,A as ae,p as ne,d as le,e as re,f as z,L as oe,g as ce}from"./index-BpRQKF8d.js";import{P as de}from"./PageTitle-C0I8t3w2.js";import{a as S,n as ie}from"./toast-BmuvtaoB.js";import{d as h}from"./Layout-KhibMNC7.js";import"./iconBase-MO_yqM0e.js";import"./logo-color-D4dEd9DP.js";const v={getAllCookieConsents:async({page:r=1,limit:i=20,consentType:o="all",device:c="all",country:p="all",startDate:j,endDate:m,search:u})=>{const d=new URLSearchParams({page:r.toString(),limit:i.toString()});return o&&o!=="all"&&d.append("consentType",o),c&&c!=="all"&&d.append("device",c),p&&p!=="all"&&d.append("country",p),j&&d.append("startDate",j),m&&d.append("endDate",m),u&&d.append("search",u),y.get(`/cookie-consent?${d.toString()}`)},getCookieConsentStats:async({startDate:r,endDate:i})=>{const o=new URLSearchParams;return r&&o.append("startDate",r),i&&o.append("endDate",i),y.get(`/cookie-consent/statistics?${o.toString()}`)},getCookieConsentById:async r=>y.get(`/cookie-consent/${r}`),deleteCookieConsent:async r=>y.delete(`/cookie-consent/${r}`),exportCookieConsents:async({startDate:r,endDate:i,consentType:o="all"})=>{const c=new URLSearchParams;return r&&c.append("startDate",r),i&&c.append("endDate",i),o&&o!=="all"&&c.append("consentType",o),y.get(`/cookie-consent/export?${c.toString()}`)}};Q.register(X,Z,ee,te,se,ae,ne,le,re);const be=()=>{const[r,i]=l.useState(!1),[o,c]=l.useState(!1),[p,j]=l.useState(h().subtract(30,"day").format("YYYY-MM-DD")),[m,u]=l.useState(h().format("YYYY-MM-DD")),[d,T]=l.useState("all"),[D,N]=l.useState("all"),[F,U]=l.useState("all"),[k,Y]=l.useState(""),[B,$]=l.useState([]),[a,H]=l.useState(null),[w,O]=l.useState(0),[A,f]=l.useState(1),[R]=l.useState(20),[xe,W]=l.useState(0),L=async()=>{try{c(!0);const s=await v.getCookieConsentStats({startDate:p,endDate:m});H(s)}catch(s){S(s?.response?.data?.message||s.message)}finally{c(!1)}},M=async()=>{try{i(!0);const s=await v.getAllCookieConsents({page:A,limit:R,consentType:d,device:D,country:F,startDate:p,endDate:m,search:k});$(s.consents),O(s.totalDoc),W(s.totalPages)}catch(s){S(s?.response?.data?.message||s.message)}finally{i(!1)}},V=async()=>{try{const s=await v.exportCookieConsents({startDate:p,endDate:m,consentType:d}),g=q(s.data),C=new Blob([g],{type:"text/csv"}),n=window.URL.createObjectURL(C),x=document.createElement("a");x.href=n,x.download=`cookie-consents-${h().format("YYYY-MM-DD")}.csv`,x.click(),ie("Data exported successfully!")}catch(s){S(s?.response?.data?.message||s.message)}},q=s=>{const g=["Date","Consent Type","Device","Browser","OS","Country","IP Address","Session ID"],C=s.map(n=>[h(n.createdAt).format("YYYY-MM-DD HH:mm:ss"),n.consentType,n.device,n.browser,n.os,n.country||"N/A",n.ipAddress||"N/A",n.sessionId]);return[g.join(","),...C.map(n=>n.join(","))].join(`
`)},G=()=>{f(1),L(),M()},J=()=>{j(h().subtract(30,"day").format("YYYY-MM-DD")),u(h().format("YYYY-MM-DD")),T("all"),N("all"),U("all"),Y(""),f(1)};l.useEffect(()=>{L(),M()},[A]);const P=()=>a?{labels:["Accepted","Rejected","Customized"],datasets:[{label:"Consent Responses",data:[a.consentTypeStats.accepted||0,a.consentTypeStats.rejected||0,a.consentTypeStats.customized||0],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(239, 68, 68, 0.8)","rgba(59, 130, 246, 0.8)"]}]}:null,E=()=>a?{labels:["Desktop","Mobile","Tablet"],datasets:[{label:"Device Distribution",data:[a.deviceStats.desktop||0,a.deviceStats.mobile||0,a.deviceStats.tablet||0],backgroundColor:["rgba(99, 102, 241, 0.8)","rgba(168, 85, 247, 0.8)","rgba(236, 72, 153, 0.8)"]}]}:null,I=()=>{if(!a||!a.trendStats)return null;const s=[...new Set(a.trendStats.map(n=>n._id.date))],g=s.map(n=>{const x=a.trendStats.find(b=>b._id.date===n&&b._id.consentType==="accepted");return x?x.count:0}),C=s.map(n=>{const x=a.trendStats.find(b=>b._id.date===n&&b._id.consentType==="rejected");return x?x.count:0});return{labels:s,datasets:[{label:"Accepted",data:g,borderColor:"rgba(34, 197, 94, 1)",backgroundColor:"rgba(34, 197, 94, 0.2)",tension:.4},{label:"Rejected",data:C,borderColor:"rgba(239, 68, 68, 1)",backgroundColor:"rgba(239, 68, 68, 0.2)",tension:.4}]}},_=()=>!a||!a.countryStats?null:{labels:a.countryStats.map(s=>s._id||"Unknown"),datasets:[{label:"Responses by Country",data:a.countryStats.map(s=>s.count),backgroundColor:"rgba(59, 130, 246, 0.8)"}]},K=s=>{switch(s){case"accepted":return e.jsx(t.Badge,{type:"success",children:"Accepted"});case"rejected":return e.jsx(t.Badge,{type:"danger",children:"Rejected"});case"customized":return e.jsx(t.Badge,{type:"primary",children:"Customized"});default:return e.jsx(t.Badge,{children:s})}};return e.jsxs(e.Fragment,{children:[e.jsx(de,{children:"Cookie Consent Analytics"}),e.jsx(t.Card,{className:"mb-8",children:e.jsx(t.CardBody,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-6",children:[e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Start Date"}),e.jsx(t.Input,{type:"date",value:p,onChange:s=>j(s.target.value),className:"mt-1"})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"End Date"}),e.jsx(t.Input,{type:"date",value:m,onChange:s=>u(s.target.value),className:"mt-1"})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Consent Type"}),e.jsxs(t.Select,{value:d,onChange:s=>T(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"customized",children:"Customized"})]})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Device"}),e.jsxs(t.Select,{value:D,onChange:s=>N(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"all",children:"All Devices"}),e.jsx("option",{value:"desktop",children:"Desktop"}),e.jsx("option",{value:"mobile",children:"Mobile"}),e.jsx("option",{value:"tablet",children:"Tablet"})]})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Search"}),e.jsx(t.Input,{type:"text",placeholder:"Session ID or IP",value:k,onChange:s=>Y(s.target.value),className:"mt-1"})]})}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(t.Button,{onClick:G,className:"w-full",children:"Apply"}),e.jsx(t.Button,{onClick:J,layout:"outline",className:"w-full",children:"Reset"})]})]})})}),o?e.jsx("div",{className:"text-center py-8",children:"Loading statistics..."}):a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-6 mb-8 md:grid-cols-2 xl:grid-cols-4",children:[e.jsx(t.Card,{children:e.jsx(t.CardBody,{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Responses"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-700 dark:text-gray-200",children:a.totalConsents})]})})}),e.jsx(t.Card,{children:e.jsx(t.CardBody,{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Acceptance Rate"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:[a.totalConsents>0?((a.consentTypeStats.accepted||0)/a.totalConsents*100).toFixed(1):0,"%"]})]})})}),e.jsx(t.Card,{children:e.jsx(t.CardBody,{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Rejection Rate"}),e.jsxs("p",{className:"text-2xl font-semibold text-red-600",children:[a.totalConsents>0?((a.consentTypeStats.rejected||0)/a.totalConsents*100).toFixed(1):0,"%"]})]})})}),e.jsx(t.Card,{children:e.jsx(t.CardBody,{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Analytics Opt-in"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:a.preferencesStats.analyticsAccepted||0})]})})})]}),e.jsxs("div",{className:"grid gap-6 mb-8 md:grid-cols-2",children:[e.jsx(t.Card,{children:e.jsxs(t.CardBody,{children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Consent Type Distribution"}),P()&&e.jsx("div",{style:{maxWidth:"300px",margin:"0 auto"},children:e.jsx(z,{data:P()})})]})}),e.jsx(t.Card,{children:e.jsxs(t.CardBody,{children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Device Distribution"}),E()&&e.jsx("div",{style:{maxWidth:"300px",margin:"0 auto"},children:e.jsx(z,{data:E()})})]})})]}),e.jsx(t.Card,{className:"mb-8",children:e.jsxs(t.CardBody,{children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Consent Trend Over Time"}),I()&&e.jsx("div",{style:{maxWidth:"600px",margin:"0 auto"},children:e.jsx(oe,{data:I(),options:{responsive:!0,plugins:{legend:{position:"top"}}}})})]})}),e.jsx(t.Card,{className:"mb-8",children:e.jsxs(t.CardBody,{children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Top Countries"}),_()&&e.jsx("div",{style:{maxWidth:"600px",margin:"0 auto"},children:e.jsx(ce,{data:_(),options:{responsive:!0,plugins:{legend:{display:!1}}}})})]})})]}),e.jsx(t.Card,{children:e.jsxs(t.CardBody,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:["Recent Consent Responses (",w,")"]}),e.jsx(t.Button,{onClick:V,size:"small",children:"Export CSV"})]}),e.jsx(t.TableContainer,{className:"mb-4",children:e.jsxs(t.Table,{children:[e.jsx(t.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(t.TableCell,{children:"Date"}),e.jsx(t.TableCell,{children:"Type"}),e.jsx(t.TableCell,{children:"Device"}),e.jsx(t.TableCell,{children:"Browser"}),e.jsx(t.TableCell,{children:"OS"}),e.jsx(t.TableCell,{children:"Country"}),e.jsx(t.TableCell,{children:"Session ID"})]})}),e.jsx(t.TableBody,{children:r?e.jsx(t.TableRow,{children:e.jsx(t.TableCell,{colSpan:"7",className:"text-center",children:"Loading..."})}):B.length===0?e.jsx(t.TableRow,{children:e.jsx(t.TableCell,{colSpan:"7",className:"text-center",children:"No consent data found"})}):B.map(s=>e.jsxs(t.TableRow,{children:[e.jsx(t.TableCell,{children:e.jsx("span",{className:"text-sm",children:h(s.createdAt).format("MMM DD, YYYY HH:mm")})}),e.jsx(t.TableCell,{children:K(s.consentType)}),e.jsx(t.TableCell,{children:e.jsx("span",{className:"capitalize",children:s.device})}),e.jsx(t.TableCell,{children:s.browser}),e.jsx(t.TableCell,{children:s.os}),e.jsx(t.TableCell,{children:s.country||"N/A"}),e.jsx(t.TableCell,{children:e.jsxs("span",{className:"text-xs font-mono",children:[s.sessionId.substring(0,12),"..."]})})]},s._id))})]})}),e.jsx(t.TableFooter,{children:e.jsx(t.Pagination,{totalResults:w,resultsPerPage:R,onChange:s=>f(s),label:"Table navigation"})})]})})]})};export{be as default};
